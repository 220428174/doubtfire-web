<div ng-if="activeTask">
  <div class="pull-left list-group col-md-2 task-status">
    <a ng-repeat="task in submittedTasks" ng-class="{'active' : task == activeTask }" class="list-group-item text-center {{statusClass(task.status)}}" ng-click="setActiveTask(task)">{{task.task_abbr}} <i class="task-icon {{statusData(task).icon}} fa-lg"></i></a>
  </div>
  <div class="col-md-10 pull-right">
    <div>
      <h4>Comments</h4>
      <div style="margin-bottom:5px">
        <form class="form-horizontal" ng-submit="addComment()" role="form">
          <label class="col-sm-2 control-label">Add Comment: </label>
          <input class="form-control col-sm-8" ng-model="comment.text" placeholder="New comment text"/>
          <button type="submit" class="btn btn-primary" style="margin-left:5px"><span class="glyphicon glyphicon-plus"></span></button>
        </form>
      </div>
      <table class="table table-condensed table-hover" ng-hide="(! activeTask.comments) || activeTask.comments.length == 0">
        <thead>
          <tr> 
            <th>Date</th>
            <th>Comment By</th>
            <th>Comment</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr ng-repeat="comment in activeTask.comments | startFrom:(currentPage - 1) * pageSize | limitTo: pageSize">
            <td>{{comment.created_at | date: 'd MMM yyyy'}}</td>
            <td>{{comment.comment_by}}</td>
            <td style="max-width:400px">{{comment.comment}}</td>
            <td><a ng-click="deleteComment(comment.id)">delete</a></td>
          </tr>
        </tbody>
      </table>
      <pagination total-items="activeTask.comments.length" ng-model="currentPage" items-per-page="pageSize" max-size="maxSize" class="pagination-sm" boundary-links="true" rotate="false" style="margin-top:0px; margin-bottom:5px"  ng-hide="(! activeTask.comments) || activeTask.comments.length < pageSize"></pagination>
    </div>

    <div id="panel" class="panel panel-default">
      <div class="panel-heading task-status row-fluid">
          <h3 class="panel-title" ng-click="showAssessTaskModal(activeTask)">{{activeTask.task_name}}</h3><!--/title-->
          <div class="pull-right">
            <div class="btn-group pdf-nav" ng-hide="shouldHideNav()">
              <button type="button" class="btn btn-default" ng-disabled="shouldDisableLeftNav()" ng-click="prevPage()">
                <span class="glyphicon glyphicon-chevron-left"></span>
              </button>
              <button type="button" class="btn btn-default" ng-disabled="shouldDisableRightNav()" ng-click="nextPage()">
                <span class="glyphicon glyphicon-chevron-right"></span>
              </button>
            </div><!--/page-nav-->
            
            <div class="well-sm task-status {{statusClass(activeTask.status)}}" tooltip-placement="right" tooltip="{{activeStatusData().label}}" ng-click="showAssessTaskModal(activeTask)">
              <i class="{{activeStatusData().icon}} fa-2x"></i>
            </div><!--/status-->
          </div>
      </div>
      <div class="panel-body">
        <p class="lead text-center" ng-hide="taskStillProcessing() || corruptPdf() || readyToShowPDF()">
          <br/>
          <i class="fa fa-spinner fa-spin fa-2x"></i>
          <br/>
          PDF is rendering...
        </p><!--/pdf-in-process-->
        <p class="lead text-center" ng-show="taskStillProcessing()">
          <br/>
          <i class="fa fa-clock-o fa-2x"></i>
          <br/>
          PDF is being processed. Come back soon.
        </p><!--/pdf-in-process-->
        <p class="lead text-center text-danger" ng-show="corruptPdf()">
          <br/>
          <i class="fa fa-exclamation-triangle fa-2x"></i>
          <br/>
          PDF preview cannot be rendered.
        </p><!--/corrupt-pdf-->
        <a href="{{activeTaskUrl()}}" ng-show="readyToShowPDF()">
          <canvas width="0" height="0" id="pdf"></canvas>
        </a><!--/pdf-->
      </div>
      <div ng-hide="taskStillProcessing()" class="panel-footer" style="height: 60px">
        <div class="pull-left text-muted">
          <strong>Note:</strong> {{activeTask.status != 'ready_to_mark' ? "Comments are viewable once PDF is downloaded" : "Comments will be available once your tutor has assessed your submission"}}
        </div>
        <div class="pull-right btn-group">
          <button class="btn btn-info" ng-click="recreatePDF()" tooltip-popup-delay='500' tooltip-placement="top" tooltip="Recreate the task's PDF">
            <span class="fa fa-recycle"></span>
          </button>
          <a href="{{activeTaskUrl()}}" class="btn btn-success">
            <span class="glyphicon glyphicon-cloud-download"></span>
          </a>
        </div>
      </div><!--/panel-footer-->
    </div>
  </div>

</div>