<button id="dialogCloseButton" mat-button mat-dialog-close mat-icon-button aria-label="Close dialog button">
  <mat-icon aria-label="Quit cross icon">close</mat-icon>
</button>
<mat-horizontal-stepper id="intelligentDiscussionStepper" *ngIf="inDiscussion || !startedDiscussion" [linear]="true"
  #stepper>
  <mat-step>
    <ng-template matStepLabel>Introduction</ng-template>
    <div class="introduction-text">
      <img id="discussion-splash-image" src="/assets/images/discussion_splash_1.svg" alt="Discussion Splash Image">
      <p>
        Your tutor would like to discuss some topics with you regarding this task. <br> <br>

        Discussions are great way for you and your tutor to gauge your understanding of concepts, and are an
        important aspect of your portfolio. <br> <br>

        These discussions are designed to be casual and informal, and will <strong>require a working microphone and
          speakers.</strong> <br><br>

        These are timed discussions, <strong> you will have a few minutes from when you hear your tutor's discussion
          prompt to reply.</strong> <br><br><br><br>

        You should only proceed once you are in a suitibly quiet envioronment.
      </p>

    </div>
    <div>
      <button mat-button mat-raised-button matStepperNext color="primary" style="float: right;">Next</button>
    </div>
  </mat-step>

  <mat-step [completed]="confirmed">
    <ng-template matStepLabel>Test everything is working</ng-template>
    <microphone-tester #testRecorder></microphone-tester>
    <mat-checkbox [(ngModel)]="confirmed" matStepperNext required> Ready to go! </mat-checkbox>
    <div>
      <button [disabled]="!confirmed" (click)="disableTester()" mat-button mat-raised-button matStepperNext
        color="primary" matStepperNext style="float: right;">Next</button>
      <button mat-button mat-raised-button matStepperNext color="primary" matStepperPrevious>Back</button>
    </div>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Discussion</ng-template>

    <div fxLayout="row" fxLayoutAlign="space-around center" id="discussionRecorderContainer">
      <button mat-button mat-stroked-button [hidden]="startedDiscussion" (click)="startDiscussion()">Start discussion</button>
      <intelligent-discussion-recorder #discussionRecorder></intelligent-discussion-recorder>
      <div fxLayout="column" fxLayoutAlign="start end">
        <p id="discussionCountdown">{{timerText}}</p>
        <p>remaining</p>
      </div>
    </div>
    <mat-divider></mat-divider>
    <div>
      <div *ngFor="let prompt of prompts">
        <audio attr.id="audio{{prompt.id}}" preload="false" controls="controls" controlsList="nodownload">
          <source src="{{prompt.url}}" type="audio/mpeg">
          Your browser does not support the HTML5 Audio element.
        </audio>
        <mat-checkbox [disabled]="prompt.id != activePromptId" attr.id="checked{{prompt.id}}"
          (change)="responseConfirmed($event)" color="primary">Complete</mat-checkbox>

      </div>
      <button [disabled]="!discussionComplete" mat-button mat-raised-button matStepperNext color="primary"
        matStepperNext required style="float: right;">Complete</button>
      <button [disabled]="startedDiscussion" mat-button mat-raised-button matStepperNext color="primary" matStepperPrevious>Back</button>
    </div>
  </mat-step>

  <mat-step>
    <ng-template matStepLabel>Done</ng-template>
    You are now done.
  </mat-step>
</mat-horizontal-stepper>

<div *ngIf="!inDiscussion && startedDiscussion">
  <p>Discussion over</p>
</div>